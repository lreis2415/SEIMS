<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<title>SEIMS: BMP scenario analysis</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygenextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="topbanner"><a href="https://github.com/lreis2415/SEIMS" title="SEIMS GitHub"><i class="githublogo"></i></a></div>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('getstart_bmp_scenario_analysis.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">BMP scenario analysis </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md4">Simple usage</a></li>
<li class="level1"><a href="#autotoc_md5">Configuration file of scenario analysis</a></li>
<li class="level1"><a href="#autotoc_md6">Advanced usage</a></li>
<li class="level1"><a href="#autotoc_md7">See more...</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_doc_en_get_started_bmp_scenario_analysis"></a></p>
<p >Different best management practices (or beneficial management practices, BMPs for short) scenarios (i.e., spatial configurations of multiple BMPs) at the watershed scale may have significantly different environmental effectiveness, economic cost-benefit, and practicality. It is valuable for decision-making of integrated watershed management to assess the environmental effectiveness and economic cost-benefit of watershed BMP scenarios and then propose optimal ones. During the BMP scenarios analysis, each individual BMP scenario is created by automatically selecting and allocating BMPs on spatial units (known as BMP configuration units). Then the effects of the scenario on watershed behavior are simulated by watershed models. The simulation result is the basis of the automatic spatial optimization of BMP scenarios.</p>
<p >As a demo, one of the experiments conducted in Zhu <em>et al.</em> (2019b) is used in this section. The hydrologically connected fields were selected as the BMPs configuration units (see Section 2:3.2 for the preparation). Four spatially explicit BMPs were considered, and the BMP configuration strategy based on expert knowledge of upstream–downstream relationships (Wu <em>et al.</em>, 2018) was adopted. The NSGA-II algorithm was integrated to achieve the spatial optimization of BMP scenarios. More information please refers to Zhu <em>et al.</em> (2019b).</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Simple usage</h1>
<p >For simple usage, open a CMD window, enter the following commands to execute the predefined BMP scenarios analysis of the Youwuzhen watershed model.</p>
<div class="fragment"><div class="line">cd D:\demo\SEIMS\seims\test</div>
<div class="line">D:</div>
<div class="line">python –m scoop –n 2 demo_scenario_analysis.py -name youwuzhen</div>
</div><!-- fragment --><p >The runtime logs of scenario analysis including commands of each model run, the average objective values (i.e., environmental effectiveness and net-cost) of each generation, and the time-consuming were showed in Figure 1.</p>
<p >Like the auto-calibration based on NSGA-II algorithm, the automatically generated BMP scenarios were imported into the <code>BMP_SCENARIOS</code> collection of the scenario database for each generation during the BMP scenarios optimization (Figure 2).</p>
<p >The results of the BMP scenarios analysis can be found in <code>SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model\SA_NSGA2_CONNFIELD_UPDOWN_Gen_2_Pop_4</code> including:</p><ul>
<li><code>Pareto_Economy-Environment</code> folder: Near optimal Pareto plots, e.g., Figure 3 showed the near optimal Pareto solutions of the first and second generations with the objectives of maximizing the environmental effectiveness and minimizing the economic net-cost.</li>
<li><p class="startli"><code>Scenarios</code> folder: The BMP scenario information in plain text file and the corresponding spatial distribution raster file. For example, one BMP scenario information of the second generation is as follows: </p><div class="fragment"><div class="line">Scenario ID: 125931440</div>
<div class="line">Gene number: 72</div>
<div class="line">Gene values: 0, 0, 0, 4, 0, 4, 0, 0, 0, 0, 0, 4, 0, 0, 0, 4, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 2, 0, 0, 4, 0, 2, 4, 4, 0, 1, 1, 0, 0, 0, 0, 4, 0, 0, 2, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0, 3, 4, 0, 2, 0, 0</div>
<div class="line">Scenario items:</div>
<div class="line">_id NAME    COLLECTION  BMPID   LOCATION    DISTRIBUTION    SUBSCENARIO ID</div>
<div class="line">481 S125931440  AREAL_STRUCT_MANAGEMENT 17  44-45-64    RASTER|FIELDS_15    1   125931440</div>
<div class="line">482 S125931440  AREAL_STRUCT_MANAGEMENT 17  21-35-40-53-70  RASTER|FIELDS_15    2   125931440</div>
<div class="line">483 S125931440  AREAL_STRUCT_MANAGEMENT 17  60-67   RASTER|FIELDS_15    3   125931440</div>
<div class="line">484 S125931440  AREAL_STRUCT_MANAGEMENT 17  4-6-12-16-34-38-41-42-50-68 RASTER|FIELDS_15    4   125931440</div>
<div class="line">485 S125931440  PLANT_MANAGEMENT    12  33  RASTER|LANDUSE  0   125931440</div>
<div class="line">Effectiveness:</div>
<div class="line">    economy: 57.712680</div>
<div class="line">    environment: 0.48278</div>
</div><!-- fragment --><p class="startli">The gene number is 72 which equals to the number of BMP configuration units, i.e., the spatial unit number of <code>FIELDS_15</code>. The gene values indicate the BMP types that configured on BMP configuration units. The value of 0 means no BMP configured. Each BMP type has one scenario item. The spatial distribution of this BMP scenario was shown in Figure 4.</p>
</li>
<li><code>runtime.log</code> file: Recoding the near optimal Pareto solutions of each generation.</li>
<li><code>hypervolume.txt</code> file: The hypervolume index of each generation.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Configuration file of scenario analysis</h1>
<p >The configuration file of BMP scenarios analysis, such as that of the Youwuzhen watershed model shown in the following code block, includes five sections, i.e., <code>SEIMS_Model</code>, <code>Scenario_Common</code>, <code>BMPs</code>, <code>NSGA2</code>, and <code>OPTIONAL_MATPLOT_SETTING</code>. Among them, <code>OPTIONAL_MATPLOT_SETTING</code> is optional. <b>The names of sections and options should not be changed.</b></p>
<div class="fragment"><div class="line">[SEIMS_Model]</div>
<div class="line">MODEL_DIR = C:\z_code\Hydro\SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model</div>
<div class="line">BIN_DIR = C:\z_code\Hydro\SEIMS\bin</div>
<div class="line">HOSTNAME = 127.0.0.1</div>
<div class="line">PORT = 27017</div>
<div class="line">threadsNum = 2</div>
<div class="line">layeringMethod = 1</div>
<div class="line">scenarioID = 0</div>
<div class="line"># Simulation period (UTCTIME)</div>
<div class="line">Sim_Time_start = 2012-01-01 00:00:00</div>
<div class="line">Sim_Time_end = 2012-05-30 23:59:59</div>
<div class="line"> </div>
<div class="line">[Scenario_Common]</div>
<div class="line">Eval_Time_start = 2012-02-27 00:00:00</div>
<div class="line">Eval_Time_end = 2012-04-30 23:59:59</div>
<div class="line">worst_economy = 300.</div>
<div class="line">worst_environment = 0.</div>
<div class="line">runtime_years = 8</div>
<div class="line">export_scenario_txt = True</div>
<div class="line">export_scenario_tif = True</div>
<div class="line"> </div>
<div class="line">[BMPs]</div>
<div class="line">BMPs_info = {&quot;17&quot;:{&quot;COLLECTION&quot;: &quot;AREAL_STRUCT_MANAGEMENT&quot;, &quot;SUBSCENARIO&quot;: [1, 2, 3, 4]}}</div>
<div class="line">BMPs_retain = {&quot;12&quot;:{&quot;COLLECTION&quot;: &quot;PLANT_MANAGEMENT&quot;, &quot;DISTRIBUTION&quot;: &quot;RASTER|LANDUSE&quot;, &quot;LOCATION&quot;: &quot;33&quot;, &quot;SUBSCENARIO&quot;: 0}}</div>
<div class="line">Eval_info = {&quot;OUTPUTID&quot;: &quot;SED_OL&quot;, &quot;ENVEVAL&quot;: &quot;SED_OL_SUM.tif&quot;, &quot;BASE_ENV&quot;: -9999}</div>
<div class="line">BMPs_cfg_units = {&quot;CONNFIELD&quot;: {&quot;DISTRIBUTION&quot;: &quot;RASTER|FIELDS_15&quot;, &quot;UNITJSON&quot;: &quot;connected_field_units_updown_15.json&quot;}}</div>
<div class="line">BMPs_cfg_method = UPDOWN</div>
<div class="line"> </div>
<div class="line">[NSGA2]</div>
<div class="line">GenerationsNum = 2</div>
<div class="line">PopulationSize = 4</div>
<div class="line">CrossoverRate = 1.0</div>
<div class="line">MaxMutatePerc = 0.2</div>
<div class="line">MutateRate = 1.0</div>
<div class="line">SelectRate = 1.0</div>
<div class="line"> </div>
<div class="line">[OPTIONAL_MATPLOT_SETTINGS]</div>
<div class="line">FIGURE_FORMATS = PDF,PNG</div>
<div class="line">LANG_CN = False</div>
<div class="line">FONT_TITLE = Times New Roman</div>
<div class="line">TITLE_FONTSIZE = 16</div>
<div class="line">LEGEND_FONTSIZE = 12</div>
<div class="line">TICKLABEL_FONTSIZE = 12</div>
<div class="line">AXISLABEL_FONTSIZE = 12</div>
<div class="line">LABEL_FONTSIZE = 14</div>
<div class="line">DPI = 300</div>
</div><!-- fragment --><ul>
<li>SEIMS_Model: Basic settings of the SEIMS-based watershed model, see Section 2:4.3.2 for details. Note that the OpenMP version of SEIMS main program is used by default. However, the options of version, <code>MPI_BIN</code>, and <code>processNum</code> are supported if the MPI&amp;OpenMP version is wanted.</li>
<li>Scenario_Common: Common settings for scenarios analysis.<ol type="1">
<li><code>Eval_Time_start</code>: Starting date time of model evaluation with the format of <code>YYYY-MM-DD HH:MM:SS</code>.</li>
<li><code>Eval_Time_end</code>: Ending date time of model evaluation with the format of <code>YYYY-MM-DD HH:MM:SS</code>.</li>
<li><code>worst_economy</code>: Economic net-cost under the circumstance of worst scenario.</li>
<li><code>worst_environment</code>: Environmental effectiveness under the circumstance of worst scenario. The worst_economy and <code>worst_environment</code> are set for the calculation of hypervolume index.</li>
<li><code>runtime_years</code>: For the BMP scenarios analysis based on the evaluation of long-term environmental effectiveness of BMPs, SEIMS assumed that BMPs can reach relative stability after several years of maintenance from their first establishment. Therefore, the <code>runtime_years</code> is specified for the evaluation of BMP scenario cost model.</li>
<li><code>Export_scenario_txt</code>: (Optional) Output each BMP scenario as plain text file (<code>True</code>) or not (<code>False</code>). The default is <code>False</code>.</li>
<li><code>Export_scenario_tif</code>: (Optional) Output the spatial distribution of each BMP scenario as GeoTiff raster file (<code>True</code>) or not (<code>False</code>). The default is <code>False</code>.</li>
</ol>
</li>
<li><code>BMPs</code>: Application specific BMPs settings.<ol type="1">
<li><code>BMPs_info</code>: <a class="el" href="group__module__setting.html#struct_information" title="Module development information class.">Information</a> of selected BMP types for BMP scenarios analysis. The JSON format is used. The key is <code>BMPID</code> (see Section 2:2.7.1) and the value is another JSON string of the corresponding field-values (available fields can be found in Table 2:2 8). Note that, the data type of the key MUST be string, although <code>BMPID</code> is integer. The <code>DISTRIBUTION</code> and <code>LOCATION</code> fields can be omitted which will be defined in <code>BMPs_cfg_units</code>. ``` BMPs_info = {"17":{ "COLLECTION": "AREAL_STRUCT_MANAGEMENT", "SUBSCENARIO": [1, 2, 3, 4] } } ``<code> 2.</code>BMPs_retain<code>: Retained BMP types for generated BMP scenarios during the optimization. The format is the same with</code>BMPs_info<code>. </code>`` BMPs_retain = {"12":{ "COLLECTION": "PLANT_MANAGEMENT", "DISTRIBUTION": "RASTER|LANDUSE", "LOCATION": "33", "SUBSCENARIO": 0 } } ``<code> 3.</code>Eval_info<code>: <a class="el" href="group__module__setting.html#struct_information" title="Module development information class.">Information</a> of model evaluation, including the</code>OUTPUTID<code>and the corresponding output filename (</code>ENVEVAL<code>) and the base value of environmental variable (</code>BASE_ENV<code>), e.g., the annual total amount of soil erosion. If the</code>BASE_ENV<code>is set to -9999, the base scenario will be firstly evaluated before the BMP scenarios analysis. </code>`` Eval_info = { "OUTPUTID": "SED_OL", "ENVEVAL": "SED_OL_SUM.tif", "BASE_ENV": -9999 } ``<code> 4.</code>BMPs_cfg_units<code>: <a class="el" href="group__module__setting.html#struct_information" title="Module development information class.">Information</a> of BMP configuration units which also follows the JSON format. The</code>UNITJSON<code>is a file that describes the basic information of each spatial unit and spatial relationships between spatial units, e.g., the upstream and downstream relationships. In the current version, the hydrologic response units (</code>HRU<code>), spatially explicit HRUs (</code>EXPLICITHRU<code>), hydrologically connected fields (</code>CONNFIELD<code>), and slope position units (</code>SLPPOS<code>) are supported. More details please refer to Zhu *et al.* (2019b). </code>`` BMPs_cfg_units = {"CONNFIELD": { "DISTRIBUTION": "RASTER|FIELDS_15", "UNITJSON": "connected_field_units_updown_15.json" } } ```</li>
<li><code>BMPs_cfg_method</code>: BMP configuration strategy used according to the characteristics of BMP configuration units, such as randomly strategy (<code>RAND</code>), strategy with knowledge on the suitable landuse types/slope positions of individual BMPs (<code>SUIT</code>), strategy based on expert knowledge of upstream–downstream relationships (<code>UPDOWN</code>, Wu <em>et al.</em> [2018]), and strategy with domain knowledge on the spatial relationships between BMPs and slope positions along the hillslope (<code>HILLSLP</code>, Qin <em>et al.</em> [2018]). More details please refer to Zhu <em>et al.</em> (2019b).</li>
</ol>
</li>
<li>Sections of specific optimization methods for scenario analysis. Currently, the NSGA-II algorithm has been integrated and tested. In the future version of SEIMS, more methods should be integrated.<ul>
<li><code>NSGA2</code>: <a class="el" href="group__module__setting.html#struct_parameter" title="Model parameter information class.">Parameter</a> settings of NSGA-II algorithm.<ul>
<li><code>GenerationsNum</code>: Maximum number of generations. PopulationSize: Initial population size, i.e., the number of individuals.</li>
<li><code>CrossoverRate</code>: Crossover probability, ranges from 0 to 1. A larger crossover rate indicates a higher possibility to take place the crossover operation between two parent individuals.</li>
<li><code>MutateRate</code>: Mutate probability.</li>
<li><code>MaxMutatePerc</code>: Maximum percent of genes to be mutated.</li>
<li><code>SelectRate</code>: Selection rate of the evaluated and sorted individuals for each generation which is known as near-optimal Pareto solutions.</li>
</ul>
</li>
</ul>
</li>
<li><code>OPTIONAL_MATPLOT_SETTINGS</code>: Plot settings for matplotlib, see Section 2:5.2.</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Advanced usage</h1>
<p >The Python scripts of scenarios analysis are in <code>SEIMS/seims/scenario_analysis/spatialunits</code>. The <code>main_nsga2.py</code> is the entrance for the scenarios analysis based on NSGA-II algorithm, which can be executed though the unified format of running SEIMS Python scripts, e.g., </p><div class="fragment"><div class="line">cd D:\demo\SEIMS\seims\scenario_analysis\spatialunits</div>
<div class="line">python main_nsga2.py -ini D:\demo\SEIMS\data\youwuzhen\workspace\scenario_analysis.ini</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
See more...</h1>
<p >Also see introduction of the Python package <a class="el" href="intro_scenario_analysis_pkg.html">seims.scenario_analysis package</a> and <a class="el" href="intro_scenario_analysis_spatialunits_pkg.html">seims.scenario_analysis.spatialunits package</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
