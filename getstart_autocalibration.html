<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<title>SEIMS: Auto-Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygenextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="topbanner"><a href="https://github.com/lreis2415/SEIMS" title="SEIMS GitHub"><i class="githublogo"></i></a></div>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('getstart_autocalibration.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Auto-Calibration </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md0">Simple usage</a></li>
<li class="level1"><a href="#autotoc_md1">Configuration file of auto-calibration</a></li>
<li class="level1"><a href="#autotoc_md2">Advanced usage</a></li>
<li class="level1"><a href="#autotoc_md3">See more...</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_doc_en_get_started_auto_calibration"></a></p>
<p >After parameter sensitivity analysis, a small number of the most sensitive parameters can be selected for auto-calibration. The value ranges of parameters may be the same with those defined in the parameter sensitivity analysis, or they may be narrowed by excluding values that result in an unacceptable model performance, such as in cases where <em>NSE</em> is less than zero.</p>
<p >In the current version of SEIMS, the NSGA-II algorithm (Non-dominated Sorting Genetic Algorithm II) was used for auto-calibration. During NSGA-II execution, the Latin-hypercube sampling method (Iman and Shortencarier, 1984) was used to generate initial samples of calibrated parameters. The crossover and mutation operations were similar to the original implementations in NSGA-II by Deb <em>et al.</em> (2002).</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Simple usage</h1>
<p >For simple usage, open a CMD window, enter the following commands to execute the auto-calibration of the streamflow modeling of the Youwuzhen watershed model.</p>
<div class="fragment"><div class="line">cd D:\demo\SEIMS\seims\test</div>
<div class="line">D:</div>
<div class="line">python –m scoop –n 2 demo_calibration.py -name youwuzhen</div>
</div><!-- fragment --><p >The runtime logs of auto-calibration including commands of each model run, the average model performance indicators of each generation, and the time-consuming were showed in Figure 1.</p>
<p >Like the parameter sensitivity analysis, the calibration values of selected parameters will be generated and imported as <code>CALI_VALUES</code> field into the <code>PARAMETERS</code> collection of the main spatial database for each generation during the optimization of auto-calibration (Figure 2).</p>
<p >The results of the auto-calibration can be found in <code>SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model\CALI_NSGA2_Gen_2_Pop_4</code>. The near-optimal Pareto solutions plotted as a scatter plot can give a simple and direct interpretation of the calibration optimization processes. For example, Figure 3 showed the near optimal Pareto solutions of the first and second generations with the objectives of maximize the <em>NSE</em> and minimize the <em>RSR</em> of the simulated streamflow at the watershed outlet, which indicated an evolutionary directory to maximum <em>NSE</em> and minimum <em>RSR</em>.</p>
<p >In the meantime, to have a better aware of the calibration results, one best solution with the maximum <em>NSE</em> of the calibration period was plotted for each generation (red dash line in Figure 4) together with the 2.5% and 97.5% levels of the cumulative distribution of the output variables (gray band in Figure 4), i.e., streamflow at the watershed outlet in this demo.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Configuration file of auto-calibration</h1>
<p >The configuration file of auto-calibration, such as that of the Youwuzhen watershed model shown in the following code block, includes four sections, i.e., <code>SEIMS_Model</code>, <code>CALI_Settings</code>, <code>NSGA2</code>, and <code>OPTIONAL_MATPLOT_SETTING</code>. Among them, <code>OPTIONAL_MATPLOT_SETTING</code> is optional. The names of sections and options should not be changed.</p>
<div class="fragment"><div class="line">[SEIMS_Model]</div>
<div class="line">MODEL_DIR = D:\demo\SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model</div>
<div class="line">BIN_DIR = D:\demo\SEIMS\bin</div>
<div class="line">HOSTNAME = 127.0.0.1</div>
<div class="line">PORT = 27017</div>
<div class="line">threadsNum = 2</div>
<div class="line">layeringMethod = 1</div>
<div class="line">scenarioID = 0</div>
<div class="line"># Simulation period (UTCTIME)</div>
<div class="line">Sim_Time_start = 2012-01-01 00:00:00</div>
<div class="line">Sim_Time_end = 2012-05-30 23:59:59</div>
<div class="line"> </div>
<div class="line">[CALI_Settings]</div>
<div class="line"># Parameters and ranges</div>
<div class="line">paramRngDef = cali_param_rng-Q.def</div>
<div class="line"># Calibration period (UTCTIME)</div>
<div class="line">Cali_Time_start = 2012-02-27 00:00:00</div>
<div class="line">Cali_Time_end = 2012-04-30 23:59:59</div>
<div class="line"># Validation period (UTCTIME)</div>
<div class="line">Vali_Time_start = 2012-05-01 00:00:00</div>
<div class="line">Vali_Time_end = 2012-05-30 23:59:59</div>
<div class="line"> </div>
<div class="line">[NSGA2]</div>
<div class="line">GenerationsNum = 2</div>
<div class="line">PopulationSize = 4</div>
<div class="line">CrossoverRate = 0.8</div>
<div class="line">MaxMutatePerc = 0.2</div>
<div class="line">MutateRate = 0.1</div>
<div class="line">SelectRate = 1.0</div>
<div class="line"> </div>
<div class="line">[OPTIONAL_MATPLOT_SETTINGS]</div>
<div class="line">FIGURE_FORMATS = PDF,PNG</div>
<div class="line">LANG_CN = False</div>
<div class="line">FONT_TITLE = Times New Roman</div>
<div class="line">TITLE_FONTSIZE = 16</div>
<div class="line">LEGEND_FONTSIZE = 12</div>
<div class="line">TICKLABEL_FONTSIZE = 12</div>
<div class="line">AXISLABEL_FONTSIZE = 12</div>
<div class="line">LABEL_FONTSIZE = 14</div>
<div class="line">DPI = 300</div>
</div><!-- fragment --><ul>
<li><code>SEIMS_Model</code>: Basic settings of the SEIMS-based watershed model, see Section 2:4.3.2 for details. Note that the OpenMP version of SEIMS main program is used by default. However, the options of version, <code>MPI_BIN</code>, and <code>processNum</code> are supported if the MPI&amp;OpenMP version is wanted.</li>
<li><code>CALI_Settings</code>: Basic settings for auto-calibration.<ol type="1">
<li><code>paramRngDef</code>: Filename of the definition of parameters’ range for calibration. The format is the same with <code>paramRngDef</code> of parameter sensitivity analysis (Section 2:6.2).</li>
<li><code>Cali_Time_start</code>: Starting date time of the calibration period for model calibration with the format of <code>YYYY-MM-DD HH:MM:SS</code>.</li>
<li><code>Cali_Time_end</code>: Ending date time of the calibration period for model calibration with the format of <code>YYYY-MM-DD HH:MM:SS</code>.</li>
<li><code>Vali_Time_start</code>: (Optional) Starting date time of the validation period with the format of <code>YYYY-MM-DD HH:MM:SS</code> for visualization only to explore the effective of the calibrated parameters, e.g., Figure 2:7 4.</li>
<li><code>Vali_Time_end</code>: (Optional) Ending date time of the validation period with the format of <code>YYYY-MM-DD HH:MM:SS</code>. The <code>Vali_Time_start</code> and <code>Vali_Time_end</code> should be specified simultaneously.</li>
<li>Note that the simulation period minus the calibration and validation period is the warm-up period.</li>
</ol>
</li>
<li>Sections of specific optimization methods for auto-calibration. Currently, the NSGA-II algorithm has been integrated and tested. In the future version of SEIMS, more methods should be integrated.<ul>
<li><code>NSGA2</code>: <a class="el" href="group__module__setting.html#struct_parameter" title="Model parameter information class.">Parameter</a> settings of NSGA-II algorithm.<ul>
<li><code>GenerationsNum</code>: Maximum number of generations.</li>
<li><code>PopulationSize</code>: Initial population size, i.e., the number of individuals.</li>
<li><code>CrossoverRate</code>: Crossover probability, ranges from 0 to 1. A larger crossover rate indicates a higher possibility to take place the crossover operation between two parent individuals.</li>
<li><code>MutateRate</code>: Mutate probability.</li>
<li><code>MaxMutatePerc</code>: Maximum percent of genes to be mutated.</li>
<li><code>SelectRate</code>: Selection rate of the evaluated and sorted individuals for each generation which is known as near-optimal Pareto solutions.</li>
</ul>
</li>
</ul>
</li>
<li><code>OPTIONAL_MATPLOT_SETTINGS</code>: Plot settings for matplotlib, see Section 2:5.2.</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Advanced usage</h1>
<p >The Python scripts of auto-calibration are in <code>SEIMS/seims/calibration</code>. The <code>main_nsga2.py</code> is the entrance for the auto-calibration based on NSGA-II algorithm, which can be executed though the unified format of running SEIMS Python scripts, e.g.,</p>
<div class="fragment"><div class="line">cd D:\demo\SEIMS\seims\calibration</div>
<div class="line">python main_nsga2.py -ini D:\demo\SEIMS\data\youwuzhen\workspace\calibration.ini</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
See more...</h1>
<p >Also see introduction of the Python package <a class="el" href="intro_auto_calibration_pkg.html">seims.calibration package</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
