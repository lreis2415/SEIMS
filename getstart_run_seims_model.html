<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<title>SEIMS: Running a SEIMS-based waterhsed model</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygenextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="topbanner"><a href="https://github.com/lreis2415/SEIMS" title="SEIMS GitHub"><i class="githublogo"></i></a></div>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('getstart_run_seims_model.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Running a SEIMS-based waterhsed model </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md67">Simple usage</a></li>
<li class="level1"><a href="#autotoc_md68">File structure of a SEIMS-based model</a><ul><li class="level2"><a href="#autotoc_md69">file.in</a></li>
<li class="level2"><a href="#autotoc_md70">file.out</a></li>
<li class="level2"><a href="#autotoc_md71">param.cali</a></li>
<li class="level2"><a href="#autotoc_md72">config.fig</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md73">Advanced usage</a><ul><li class="level2"><a href="#autotoc_md74">Run with command line interface</a><ul><li class="level3"><a href="#autotoc_md75">OpenMP version</a></li>
<li class="level3"><a href="#autotoc_md76">MPI&amp;OpenMP version</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md77">Run with Python</a></li>
<li class="level2"><a href="#autotoc_md78">Customize the demo Youwuzhen watershed model</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_doc_en_get_started_run_model"></a></p>
<h1><a class="anchor" id="autotoc_md67"></a>
Simple usage</h1>
<p >For simple usage, open a terminal (e.g., CMD on Window), enter the following commands to execute the predefined SEIMS-based watershed model of the Youwuzhen watershed (hereafter referred to as the Youwuzhen watershed model): </p><div class="fragment"><div class="line">cd D:\demo\SEIMS\seims\test</div>
<div class="line">D:</div>
<div class="line">python demo_runmodel.py â€“name youwuzhen</div>
</div><!-- fragment --><p >The simulation will be finished in about 28 seconds (Figure 1). The predefined output information can be found in the model folder (i.e., <code>MODEL_DIR\OUTPUT0</code>), such as Figure 2.</p>
<p ><img src="../../img/screenshot-runmodel-simple-usage.jpg" alt="ywzrunmodelsimple" class="inline"/> <img src="screenshot-runmodel-simple-usage.jpg" alt="ywzrunmodelsimple" width="400" class="inline"/></p>
<p >Figure 1 Simple usage of the OpenMP version of the Youwuzhen watershed model</p>
<p ><img src="../../img/screenshot-runmodel-output0-simple-usage.jpg" alt="ywzrunmodeloutput0" class="inline"/> <img src="screenshot-runmodel-output0-simple-usage.jpg" alt="ywzrunmodeloutput0" width="400" class="inline"/></p>
<p >Figure 2 Predefined outputs of the Youwuzhen watershed model</p>
<h1><a class="anchor" id="autotoc_md68"></a>
File structure of a SEIMS-based model</h1>
<p >In simple terms, a SEIMS-based watershed model is a folder (e.g., <code>SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model</code>) which consists of several SEIMS configuration files such as <code>file.in</code>, <code>file.out</code>, <code>param.cali</code>, and <code>config.fig</code>.</p>
<p >The <code>file.in</code> and <code>file.out</code> for basic model configuration are required, while <code>param.cali</code> for calibrated model parameters is optional. <strike>These three plain text files will be read and imported into the main spatial database during data preprocessing (Section 2:3.2)</strike>. The MongoDB also can be updated by only running a single preprocessing Python script (i.e., <code>SEIMS\seims\preprocess\db_import_model_parameters.py</code>) when these files are changed such as during the manual calibration.</p>
<p >The <code>config.fig</code> file, the most important configuration file for constructing a SEIMS-based watershed model, is responsible for selecting SEIMS modules to participate in the watershed simulation, as well as specifying the simulation order of SEIMS modules.</p>
<h2><a class="anchor" id="autotoc_md69"></a>
file.in</h2>
<p >The <code>file.in</code> file is designed to define the simulation mode with time-step and the simulation period. Different from the plain text format described in <a class="el" href="getstart_data_preparation.html#dataprep_basic_plaintest">here</a>, the basic format is <code>[TAG]|[VALUE]</code>. Currently, there are four required <code>TAG</code>s which must appear in this file.</p><ul>
<li><code>MODE</code>: A string that indicates a long-term or storm event simulation. The string here can only be <code>Daily</code> or <code>Storm</code> (case insensitive).</li>
<li><p class="startli"><code>INTERVAL</code>: An integer to specify the time-step (or the so-called temporal resolution) of simulation according to the simulation <code>MODE</code>. For long-term simulation, the unit is day, e.g., <code>INTERVAL|1</code> means the time-step is one day. For storm event simulation, the unit is second, e.g., <code>INTERVAL|3600</code> means the time-step is one hour.</p>
<p class="startli">Specifically, two different time-steps can be assigned for storm event simulation considering the differences between hillslope scale processes and channel scale process. For example, <code>INTERVAL|60,3600</code> means that the time-step for hillslope scale processes is one minute and one hour for channel scale processes.</p>
</li>
<li><code>STARTTIME</code>: Starting date time of simulation with the format of <code>YYYY-MM-DD HH:MM:SS</code></li>
<li><code>ENDTIME</code>: Ending date time of simulation with the format of <code>YYYY-MM-DD HH:MM:SS</code></li>
</ul>
<p >For the Youwuzhen watershed model, which performs a long-term simulation with a time-step of one day and runs from Jan 1, 2012, to Dec 31, 2015, the content of <code>file.in</code> file is as follows.</p>
<div class="fragment"><div class="line">MODE|Daily</div>
<div class="line">INTERVAL|1</div>
<div class="line">STARTTIME|2012-01-01 00:00:00</div>
<div class="line">ENDTIME|2015-12-31 23:59:59</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
file.out</h2>
<p >The <code>file.out</code> file is designed to define the outputs of a SEIMS-based watershed model. The format follows the plain text format described in <a class="el" href="getstart_data_preparation.html#dataprep_basic_plaintest">here</a>. Each line is corresponding to one output variable. The available fields of each line are listed in Table 1.</p>
<p >Table 1 Available fields of <code>file.out</code> configuration file</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Field name   </th><th class="markdownTableHeadNone">Datatype   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OUTPUTID   </td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">Unique output identifier, e.g., QRECH for the streamflow at reach outlet.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">TYPE   </td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">Data aggregation type for spatial data outputs, i.e., SUM, AVE, MAX, and MIN. Multiple types should be concatenated by En dash. For example, SUM-AVE means output the sum and average simultaneously. For time-series outputs, the TYPE can be NONE.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">STARTTIME   </td><td class="markdownTableBodyNone">Datetime string   </td><td class="markdownTableBodyNone">Starting date time for the current output with the format of YYYY-MM-DD HH:MM:SS    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ENDTIME   </td><td class="markdownTableBodyNone">Datetime string   </td><td class="markdownTableBodyNone">Ending date time for the current output with the format of YYYY-MM-DD HH:MM:SS    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">INTERVAL   </td><td class="markdownTableBodyNone">Integer   </td><td class="markdownTableBodyNone">Time-step for output. The default is -9999, which means the same time-step with the simulation will be used.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">INTERVAL_UNIT   </td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">Unit for INTERVAL, can be DAY and SEC. The default is -9999, which means the same with the simulation.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">FILENAME   </td><td class="markdownTableBodyNone">String   </td><td class="markdownTableBodyNone">Output filename with suffix, e.g., Q.txt and PET.tif.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SUBBASIN   </td><td class="markdownTableBodyNone">String or Integer   </td><td class="markdownTableBodyNone">Selected subbasins for output, can be ALL, OUTLET, or the subbasin IDs concatenated with En dash, e.g., 1-4-5.   </td></tr>
</table>
<p >Among these fields, only the <code>OUTPUTID</code> is required. The values of missed fields will adopt the default values defined in the available output database which can be extended by users, i.e., <code>SEIMS\seims\preprocess\database\AvailableOutputs.csv</code>. So, users can specify the outputs of <code>QRECH</code> (Streamflow at reach outlet of each time step, m3/s) and <code>PET</code> (Potential evapotranspiration, mm) by simply specifying the output IDs, e.g., </p><div class="fragment"><div class="line">OUTPUTID</div>
<div class="line">QRECH</div>
<div class="line">PET</div>
</div><!-- fragment --><p> or specifying more detail information, e.g.,</p>
<div class="fragment"><div class="line">OUTPUTID,TYPE,STARTTIME,ENDTIME,INTERVAL,INTERVAL_UNIT,SUBBASIN</div>
<div class="line">QRECH,NONE,2012-01-01 00:00:00,2015-12-31 23:59:59,1,DAY,OUTLET</div>
<div class="line">PET,SUM-AVE,2012-01-01 00:00:00,2015-12-31 23:59:59,-9999,-9999,ALL</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md71"></a>
param.cali</h2>
<p >The <code>param.cali</code> file is designed to define calibrated parameters. The absent of this file or a blank file is allowed and indicates the model will be executed with default parameter values. The format MUST be <code>NAME</code>, <code>IMPACT</code>, and <code>CHANGE</code>, while <code>CHANGE</code> is optional, and no header line is allowed. The <code>NAME</code> MUST be one of the predefined list of parameters which can be extended by users, i.e., <code>SEIMS\seims\preprocess\database\model_param_ini.csv</code>. The <code>CHANGE</code> means the type of impact on the parameter, which can be <code>RC</code> (relative change) or <code>AC</code> (absolute change). The <code>IMPACT</code> is a float value of change, for <code>RC</code>, the new parameter value will be <code>initial_value * impact</code>, while for <code>AC</code> it is <code>initial_value + impact</code>.</p>
<p >Thus, three styles are accepted in <code>param.cali</code> file, such as:</p>
<div class="fragment"><div class="line">Runoff_co,1.5</div>
<div class="line">gw0,-50,</div>
<div class="line">K_pet,-0.3,AC</div>
</div><!-- fragment --><p >Note that the script <code>db_import_model_parameters.py</code> should be executed once you have modified the <code>param.cali</code> file.</p>
<h2><a class="anchor" id="autotoc_md72"></a>
config.fig</h2>
<p >The <code>config.fig</code> file is designed to define SEIMS modules used in a SEIMS-based watershed model. <b>The sequences of these modules will be the execution order during simulation.</b> The basic order of SEIMS modules should be driver factors (i.e., climate data) related modules, modules of hillslope processes, and modules of channel and groundwater routing processes, such as the <code>config.fig</code> content of the Youwuzhen watershed model in Figure 2:4 3. More details about the selected modules of the Youwuzhen watershed model can be found in Qin et al. (2018).</p>
<div class="fragment"><div class="line">01 ### Driver factors, including meteorological data and precipitation</div>
<div class="line">02 0 | TimeSeries | | TSD_RD</div>
<div class="line">03 0 | Interpolation_0 | Thiessen | ITP</div>
<div class="line">04 ### Surface processes</div>
<div class="line">05 0 | Soil temperature | Finn Plauborg | STP_FP</div>
<div class="line">06 0 | PET | PenmanMonteith | PET_PM</div>
<div class="line">07 0 | Interception | Maximum Canopy Storage | PI_MCS</div>
<div class="line">08 0 | Snow melt | Snowpeak Daily | SNO_SP</div>
<div class="line">09 0 | Infiltration | Modified rational | SUR_MR</div>
<div class="line">10 0 | Depression and Surface Runoff | Linsley | DEP_LINSLEY</div>
<div class="line">11 0 | Hillslope erosion | MUSLE | SERO_MUSLE</div>
<div class="line">12 0 | Plant Management Operation | SWAT | PLTMGT_SWAT</div>
<div class="line">13 0 | Percolation | Storage routing | PER_STR</div>
<div class="line">14 0 | Subsurface | Darcy and Kinematic | SSR_DA</div>
<div class="line">15 0 | SET | Linearly Method from WetSpa | SET_LM</div>
<div class="line">16 0 | PG | Simplified EPIC | PG_EPIC</div>
<div class="line">17 0 | ATMDEP | Atomosphere deposition | ATMDEP</div>
<div class="line">18 0 | NUTR_TF | Nutrient Transformation of C, N, and P | NUTR_TF</div>
<div class="line">19 0 | Water overland routing | IUH | IUH_OL</div>
<div class="line">20 0 | Sediment overland routing | IUH | IUH_SED_OL</div>
<div class="line">21 0 | Nutrient | Attached nutrient loss | NUTRSED</div>
<div class="line">22 0 | Nutrient | Soluble nutrient loss | NUTRMV</div>
<div class="line">23 0 | Pothole | SWAT cone shape | IMP_SWAT</div>
<div class="line">24 0 | Soil water | Water balance | SOL_WB</div>
<div class="line">25 ### Route Modules, including water, sediment, and nutrient</div>
<div class="line">26 0 | Groundwater | Linear reservoir | GWA_RE</div>
<div class="line">27 0 | Nutrient | groundwater nutrient transport | NUTRGW</div>
<div class="line">28 0 | Water channel routing | MUSK | MUSK_CH</div>
<div class="line">29 0 | Sediment channel routing | Simplified Bagnold equation | SEDR_SBAGNOLD</div>
<div class="line">30 0 | Nutrient | Channel routing | NutrCH_QUAL2E</div>
</div><!-- fragment --><p >As shown above, different from the plain text format described in <a class="el" href="getstart_data_preparation.html#dataprep_basic_plaintest">here</a>, the basic format for each selected SEIMS module is <code>[MODULE NO.]|[PROCESS NAME]|[METHOD NAME]|[MODULE ID]</code>, in which,</p><ul>
<li><code>MODULE NO.</code> could be any number</li>
<li><code>PROCESS NAME</code> is the name of the corresponding watershed process</li>
<li><code>METHOD NAME</code> is the name of the algorithm to simulate the watershed process</li>
<li><code>MODULE ID</code> is the ID of the SEIMS module, i.e., the file name of the corresponding dynamic library (<code>dll</code>, <code>so</code>, or <code>dylib</code>) file. If the module cannot be located or loaded, SEIMS will exit and report an error.</li>
</ul>
<p >SEIMS main program only uses the <code>PROCESS NAME</code> and <code>MODULE ID</code>, while the <code>MODULE NO.</code> and <code>METHOD NAME</code> are just designed for readability. The <code>MODULE ID</code> should match exactly with the ID of SEIMS module. The <code>PROCESS NAME</code> may contain extra configuration information for some modules.</p>
<ul>
<li>For interpolation modules, the vertical interpolation method (0 means do not perform vertical interpolation based on lapse rate, while 1 means do) must be specified as suffix of the <code>PROCESS NAME</code>, e.g., <code>0 | Interpolation_1 | Thiessen | ITP</code></li>
</ul>
<blockquote class="doxtable">
<p >TODO: In the current version of SEIMS, the lapse rate of precipitation and temperature are defined as constants, i.e., 0.03 mm/100 m for precipitation and -0.65 degC/100 m for temperature. In the future development, the lapse rate of various meteorological variables should be allowed as inputs according to the study area. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md73"></a>
Advanced usage</h1>
<p >The SEIMS main programs include an OpenMP version (i.e., <code>seims_omp</code>) and a version which is a hybrid of OpenMP and MPI (hereafter referred to as MPI&amp;OpenMP version, i.e., <code>seims_mpi</code>). In the OpenMP version, parallel computing is conducted at the basic-unit level (e.g., gridded cells or irregularly shaped fields) in each module based on OpenMP. In the MPI&amp;OpenMP version, the watershed is first decomposed into subbasins, and MPI-based parallel computation is conducted at the subbasin level. And then within each subbasin, same as the OpenMP version, OpenMP-based parallel computation is conducted at the basic-unit level.</p>
<blockquote class="doxtable">
<p >Note: If OpenMP is not supported by the C/C++ compiler, the OpenMP-based parallel computing will not take affect and the executable name of SEIMS main program will be <code>seims</code>. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md74"></a>
Run with command line interface</h2>
<p >The Command Line Interface (CLI) is the recommended way to run SEIMS-based watershed model. The invoking commands are slightly different between the OpenMP version and MPI&amp;OpenMP version. </p>
<h3><a class="anchor" id="autotoc_md75"></a>
OpenMP version</h3>
<p >The complete and recommended usage of the OpenMP version of SEIMS main program is as follows.</p>
<div class="fragment"><div class="line">seims_omp -wp &lt;modelPath&gt; [-thread &lt;threadsNum&gt; -lyr &lt;layeringMethod&gt; -host &lt;hostname&gt; -port &lt;port&gt; -sce &lt;scenarioID&gt; -cali &lt;calibrationID&gt; -id &lt;subbasinID&gt;]</div>
</div><!-- fragment --><p >In which,</p><ol type="1">
<li><code>modelPath</code> is the path of the SEIMS-based watershed model (see <code>MODEL_DIR</code> in the configuration file of data preprocessing, Section 2:3.2).</li>
<li><code>threadsNum</code> (Optional) is the number of threads used for OpenMP-based parallel computing, which must be greater or equal than 1 (default).</li>
<li><code>layeringMethod</code> (Optional) can be 0 and 1, which means the routing layering method based on flow direction algorithms of <code>UPDOWN</code> (default, layering from source) and <code>DOWNUP</code> (layering from outlet), respectively.</li>
<li><code>hostname</code> is the IP address of MongoDB server. The default is <code>127.0.0.1</code> (i.e., <code>localhost</code>).</li>
<li><code>port</code> is the port number of MongoDB server, and the default is 27017.</li>
<li><code>scenarioID</code> is the ID of BMP scenario which has been defined in the <code>BMP_SCENARIOS</code> collection of Scenario database. By default, the scenarioID is -1, which means no scenario will be applied.</li>
<li><code>calibrationID</code> is the ID (i.e., index) of calibration data which has been defined in <code>PARAMETERS</code> collection of the main database. By default, the <code>calibrationID</code> is -1, which means no calibration will be applied.</li>
<li><code>subbasinID</code> is the subbasin that will be executed. 0 means the whole watershed. 9999 is reserved for Field version.</li>
<li>todo for more available arguments.</li>
</ol>
<p >For the Youwuzhen watershed, one of the complete usages is like:</p>
<div class="fragment"><div class="line">cd D:\demo\SEIMS\bin</div>
<div class="line">D:</div>
<div class="line">seims_omp -wp D:\demo\SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model -thread 4 -lyr 1 -host 127.0.0.1 -port 27017 -sce 0</div>
</div><!-- fragment --><p >The runtime logs of the OpenMP version were shown in Figure 2:4 1, in which the time-consuming of data Input/Output (IO), computation of each module, and entire simulation were shown.</p>
<p >The output folder was created in the model directory with the folder name followed a naming format of <code>OUTPUT&lt;_MPI&gt;-&lt;FlowDir&gt;-&lt;LayerMethod&gt;-&lt;scenarioID&gt;-&lt;calibrationID&gt;</code>.</p>
<h3><a class="anchor" id="autotoc_md76"></a>
MPI&amp;OpenMP version</h3>
<p >The MPI&amp;OpenMP version of SEIMS main program has the same arguments with the OpenMP version but the different way of invoking it (Figure 3:1 1). The basic format to run a MPI program is:</p>
<div class="fragment"><div class="line">mpiexec -&lt;hostsopt&gt; &lt;hostfile&gt; -n &lt;processNum&gt; seims_mpi -wp &lt;modelPath&gt; [-thread &lt;threadsNum&gt; -lyr &lt;layeringMethod&gt; -host &lt;hostname&gt; -port &lt;port&gt; -sce &lt;scenarioID&gt; -cali &lt;calibrationID&gt; -id &lt;subbasinID&gt;]</div>
</div><!-- fragment --><p >In which,</p><ol type="1">
<li><code>hostopt</code> (Optional) is the identifier of the input argument of MPI to specify a host list file which is various with different MPI implementations, e.g., <code>-machinefile</code> or <code>-hostfile</code>.</li>
<li><code>hostfile</code> (Optional) is the host list file which may be different with MPI implementation. For example, OpenMPI takes the format like: <div class="fragment"><div class="line">b10n08.cluster.com slots=3 max-slots=3</div>
<div class="line">b08n01.cluster.com slots=4 max-slots=4</div>
<div class="line">b10n05.cluster.com slots=4 max-slots=4</div>
</div><!-- fragment --> and IntelMPI uses: <div class="fragment"><div class="line">b10n08.cluster.com 3</div>
<div class="line">b08n01.cluster.com 4</div>
<div class="line">b10n05.cluster.com 4</div>
</div><!-- fragment --></li>
<li><code>processNum</code> (Optional) is the number of processes.</li>
</ol>
<p >For the Youwuzhen watershed, one of the complete usages for the MPI&amp;OpenMP version on Windows platform is like:</p>
<div class="fragment"><div class="line">cd D:\demo\SEIMS\bin</div>
<div class="line">D:</div>
<div class="line">mpiexec -n 4 seims_mpi -wp D:\demo\SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model -thread 1 -lyr 1 -host 127.0.0.1 -port 27017 -sce 0</div>
</div><!-- fragment --><p >The corresponding runtime output logs was shown in Figure 2:4 5. Different from the output information of the OpenMP version (Figure 2:4 1), the maximum (<code>[TIMESPAN][MAX]</code>), minimum (<code>[TIMESPAN][MIN]</code>), and average (<code>[TIMESPAN][AVG]</code>) time-consuming of data IO, computation of all modules, and entire simulation derived from each process (i.e., four processes of MPI in this example) are given. The maximum time-consuming is the most used statistics for the evaluation of parallel performance.</p>
<h2><a class="anchor" id="autotoc_md77"></a>
Run with Python</h2>
<p >Except for the CLI way, SEIMS also provides a configuration file based method to execute model with Python. Same with the simple usage of data preprocessing (2:3.2), a configuration file was also generated according to the local paths of SEIMS during the simple usage of running the Youwuzhen watershed model, such as <code>SEIMS\data\youwuzhen\workspace\runmodel.ini</code> (Figure 2:4 7).</p>
<p >The configuration file of running SEIMS-based watershed model, such as that of the Youwuzhen watershed model shown in Figure 2:4 7, includes several options within one section (i.e., <code>SEIMS_Model</code>) to specify the arguments of SEIMS main programs introduced in previous sections. The full list of the arguments are as follows.</p>
<ul>
<li><code>SEIMS_Model</code>:<ol type="1">
<li><code>MODEL_DIR</code>: The model path of the study area which includes several configuration files for the watershed modeling.</li>
<li><code>BIN_DIR</code>: The path of SEIMS modules and main programs, which is the same with <code>CPP_PROGRAM_DIR</code> defined in the configuration file of data preprocessing (i.e., the <code>preprocess.ini</code>; see Section 2:3.2) by default.</li>
<li><code>HOSTNAME</code>: IP address of MongoDB server, e.g., <code>127.0.0.1</code> (i.e., <code>localhost</code>).</li>
<li><code>PORT</code>: Port of MongoDB server, e.g., 27017 by the default.</li>
<li><code>VERSION</code>: (Optional) Version of SEIMS main program which can be <code>OMP</code> and <code>MPI</code> for OpenMP version and MPI&amp;OpenMP version, respectively. The default is <code>OMP</code>.</li>
<li><code>MPI_BIN</code>: (Optional) Full path of the executable of MPI, e.g., <code>C:\Program Files\Microsoft MPI\Bin\mpiexec.exe</code>.</li>
<li><code>hostopt</code>: (Optional) The identifier of the input argument of MPI to specify a host list file which is various with different MPI implementations, e.g., <code>-machinefile</code> or <code>-hostfile</code>. <code>hostfile</code>: (Optional) The host list file which may be different with MPI implementation.</li>
<li><code>processNum</code>: (Optional) The number of processes, the default is 1.</li>
<li><code>threadsNum</code>: (Optional) The number of threads per process, the default is 4.</li>
<li><code>layeringMethod</code>: (Optional) Routing layering method based on flow direction algorithms, can be 0 or 1.</li>
<li><code>scenarioID</code>: (Optional) The ID of BMP scenario.</li>
<li><code>calibrationID</code>: (Optional) The ID (i.e., index) of calibration data.</li>
<li><code>subbasinID</code>: (Optional) The ID of subbasin, 0 for the whole watershed and 9999 is reserved for Field version.</li>
<li><code>Sim_Time_start</code>: (Optional) Starting date time of simulation with the format of <code>YYYY-MM-DD HH:MM:SS</code>.</li>
<li><code>Sim_Time_end</code>: (Optional) Ending date time of simulation with the format of <code>YYYY-MM-DD HH:MM:SS</code>. If not specified, the starting and ending date time prepared in database (i.e., <code>FILE_IN</code> collection) will be applied.</li>
<li><code>Output_Time_start</code>: (Optional) Starting date time of output items with the format of <code>YYYY-MM-DD HH:MM:SS</code>.</li>
<li><code>Output_Time_end</code>: (Optional) Ending date time of output items with the format of <code>YYYY-MM-DD HH:MM:SS</code>. If specified, the time period of all selected output IDs in <code>FILE_OUT</code> collection will be updated and applied.</li>
</ol>
</li>
</ul>
<div class="fragment"><div class="line">[SEIMS_Model]</div>
<div class="line">MODEL_DIR = D:\demo\SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model</div>
<div class="line">BIN_DIR = D:\demo\SEIMS\bin</div>
<div class="line">HOSTNAME = 127.0.0.1</div>
<div class="line">PORT = 27017</div>
<div class="line">version = OMP</div>
<div class="line">mpi_bin = mpiexec</div>
<div class="line"># hostopt = ...</div>
<div class="line"># hostfile = ...</div>
<div class="line">processNum = 2</div>
<div class="line">threadsNum = 4</div>
<div class="line">layeringMethod = 1</div>
<div class="line">scenarioID = 0</div>
<div class="line">calibrationID = -1</div>
<div class="line">subbasinID = 0</div>
<div class="line"># Simulation period (UTCTIME)</div>
<div class="line">Sim_Time_start = 2012-01-01 00:00:00</div>
<div class="line">Sim_Time_end = 2015-12-31 23:59:59</div>
<div class="line"># Time period of ALL selected outputs</div>
<div class="line">Output_Time_start = 2012-01-01 00:00:00</div>
<div class="line">Output_Time_end = 2015-12-31 00:00:00</div>
</div><!-- fragment --><p >To run the SEIMS-based watershed model defined by the configuration file described above, please follow the unified format of running SEIMS Python scripts, e.g.,</p>
<div class="fragment"><div class="line">cd D:\demo\SEIMS\seims</div>
<div class="line">python run_seims.py -ini D:\demo\SEIMS\data\youwuzhen\workspace\runmodel.ini</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md78"></a>
Customize the demo Youwuzhen watershed model</h2>
<p >To demonstrate the ability of SEIMS to construct different watershed models, a simple change is made to the Youwuzhen watershed model, i.e., replacing the Penman-Monteith method (<code>PET_PM</code>) to the Priestley-Taylor method (<code>PET_PT</code>) for the simulation of potential evapotranspiration. Note that, except for the potential evapotranspiration, the <code>PET_PM</code> module also simulates the potential plant transpiration while the <code>PET_PT</code> not, thus the module named AET_PTH is added for the simulation of potential plant transpiration and potential and actual soil evaporation. Meanwhile, the soil evaporation module (<code><a class="el" href="group___s_e_t___l_m.html#class_s_e_t___l_m" title="Calculate soil Temperature according to the linearly relationship with actual soil moisture.">SET_LM</a></code>) is no longer need. The newly customized Youwuzhen watershed model (i.e., the <code>config.fig</code> file) is as follows:</p>
<div class="fragment"><div class="line">01 ### Driver factors, including climate and precipitation</div>
<div class="line">02 0 | TimeSeries | | TSD_RD</div>
<div class="line">03 0 | Interpolation_0 | Thiessen | ITP</div>
<div class="line">04 ### Surface processes</div>
<div class="line">05 0 | Soil temperature | Finn Plauborg | STP_FP</div>
<div class="line">06 0 | PET | PriestleyTaylor | PET_PT</div>
<div class="line">07 #0 | PET | PenmanMonteith | PET_PM</div>
<div class="line">08 0 | Interception | Maximum Canopy Storage | PI_MCS</div>
<div class="line">09 0 | Snow melt | Snowpeak Daily | SNO_SP</div>
<div class="line">10 0 | Infiltration | Modified rational | SUR_MR</div>
<div class="line">11 0 | Depression and Surface Runoff | Linsley | DEP_LINSLEY</div>
<div class="line">12 0 | Hillslope erosion | MUSLE | SERO_MUSLE</div>
<div class="line">13 0 | Plant Management Operation | SWAT | PLTMGT_SWAT</div>
<div class="line">14 0 | Percolation | Storage routing | PER_STR</div>
<div class="line">15 0 | Subsurface | Darcy and Kinematic | SSR_DA</div>
<div class="line">16 0 | AET | Hargreaves and PriestleyTaylor | AET_PTH</div>
<div class="line">17 #0 | SET | Linearly Method from WetSpa | SET_LM</div>
<div class="line">18 0 | PG | Simplified EPIC | PG_EPIC</div>
<div class="line">19 0 | ATMDEP | Atomosphere deposition | ATMDEP</div>
<div class="line">20 0 | NUTR_TF | Nutrient Transformation of C, N, and P | NUTR_TF</div>
<div class="line">21 0 | Water overland routing | IUH | IUH_OL</div>
<div class="line">22 0 | Sediment overland routing | IUH | IUH_SED_OL</div>
<div class="line">23 0 | Nutrient | Attached nutrient loss | NUTRSED</div>
<div class="line">24 0 | Nutrient | Soluble nutrient loss | NUTRMV</div>
<div class="line">25 0 | Pothole | SWAT cone shape | IMP_SWAT</div>
<div class="line">26 0 | Soil water | Water balance | SOL_WB</div>
<div class="line">27 ### Route Modules, including water, sediment, and nutrient</div>
<div class="line">28 0 | Groundwater | Linear reservoir | GWA_RE</div>
<div class="line">29 0 | Nutrient | groundwater nutrient transport | NUTRGW</div>
<div class="line">30 0 | Water channel routing | MUSK | MUSK_CH</div>
<div class="line">31 0 | Sediment channel routing | Simplified Bagnold equation | SEDR_SBAGNOLD</div>
<div class="line">32 0 | Nutrient | Channel routing | NutrCH_QUAL2E</div>
</div><!-- fragment --><p >With all model parameters remain the default values, the demo Youwuzhen watershed model and the new customized model were executed respectively. Figure 2:4 9 showed the spatial distributions of average potential evapotranspiration simulated by the Penman-Monteith method (Figure 2:4 9a) and Priestley-Taylor method (Figure 2:4 9b), which have a very similar spatial pattern but different values. The differences of the simulated potential evapotranspiration can also be reflected in the simulated streamflow at the watershed outlet (Figure 2:4 10). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
