<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<title>SEIMS: Postprocessing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygenextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="topbanner"><a href="https://github.com/lreis2415/SEIMS" title="SEIMS GitHub"><i class="githublogo"></i></a></div>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('getstart_runmodel_postprocessing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Postprocessing </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md63">Simple usage</a></li>
<li class="level1"><a href="#autotoc_md64">Configuration file of postprocessing</a></li>
<li class="level1"><a href="#autotoc_md65">Advanced usage</a></li>
<li class="level1"><a href="#autotoc_md66">See more...</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_doc_en_get_started_postprocessing"></a></p>
<p >After running a SEIMS-based watershed model, the postprocessing tool may be used for the calculation of model performance statistics such as Nash-Sutcliffe Efficiency (NSE), and the plotting of hydrographs of time-series data at the reach outlet such as streamflow and sediment. </p>
<h1><a class="anchor" id="autotoc_md63"></a>
Simple usage</h1>
<p >For simple usage, open a CMD window, enter the following commands to execute the postprocessing of the Youwuzhen watershed model.</p>
<div class="fragment"><div class="line">cd D:\demo\SEIMS\seims\test</div>
<div class="line">D:</div>
<div class="line">python demo_postprocess.py -name youwuzhen</div>
</div><!-- fragment --><p >The runtime logs of postprocessing showed input paths and output model performance statistics (Figure 2:5 1).</p>
<p >By default, the hydrographs of streamflow (e.g., <code>Q.txt</code>) and sediment (e.g., <code>SED.txt</code>) at the watershed outlet were plotted and saved as figure files with the formats of PNG and PDF, e.g., <code>SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model\OUTPUT0\png\Q-2013-01-01-2015-12-31.png</code> (Figure 2:5 2).</p>
<h1><a class="anchor" id="autotoc_md64"></a>
Configuration file of postprocessing</h1>
<p >Same to the data preprocessing, the simple usage of postprocessing also includes generating the configuration <code>INI</code> file according to the local paths of SEIMS such as Figure 2:5 3, and executing postprocessing by the advanced usage (See Section 2:5.3).</p>
<p >The configuration file of postprocessing, such as that of the Youwuzhen watershed model shown in Figure 2:5 3, includes four sections, i.e., <code>SEIMS_Model</code>, <code>PARAMETERS</code>, <code>OPTIONAL_PARAMETERS</code>, and <code>OPTIONAL_MATPLOT_SETTING</code>. Among them, <code>OPTIONAL_PARAMETERS</code> and <code>OPTIONAL_MATPLOT_SETTING</code> are optional. The names of sections and options should not be changed.</p><ul>
<li><code>SEIMS_Model</code>: Basic settings of the SEIMS-based watershed model, including <code>HOSTNAME</code>, <code>PORT</code>, <code>MODEL_DIR</code>, <code>BIN_DIR</code>, <code>scenarioID</code>, and <code>calibrationID</code>, etc. The meanings of these options have been introduced in Section 2:4.3.2.</li>
<li><code>PARAMETERS</code><ul>
<li><code>PLOT_SUBBASINID</code>: The subbasin ID to be plotted.</li>
<li><code>PLOT_VARIABLES</code>: The variables to be plotted, such as <code>Q</code>, <code>SED</code>, and <code>CH_TN</code>. Multiple variables can be separated by comma. Note that, the specified subbasin ID and the corresponding variables MUST be set as time-series output data in file.out (Section 2:4.2.2) and/or <code>FILE_OUT</code> collection of the main MongoDB database. If there is no matched observed data for the specified variable, the model performance statistics will not able to be calculated.</li>
</ul>
</li>
<li><code>OPTIONAL_PARAMETERS</code>: (Optional) Time period of model calibration and validation. The starting and ending date times of either calibration or validation MUST be presented or omitted simultaneously.<ul>
<li><code>Cali_Time_start</code>: Starting date time of model calibration with the format of <code>YYYY-MM-DD HH:MM:SS</code>.</li>
<li><code>Cali_Time_end</code>: Ending date time of model calibration.</li>
<li><code>Vali_Time_start</code>: Starting date time of model validation.</li>
<li><code>Vali_Time_end</code>: Ending date time of model validation.</li>
</ul>
</li>
<li><code>OPTIONAL_MATPLOT_SETTINGS</code>: (Optional) Plot settings for matplotlib.<ul>
<li><code>FIGURE_FORMATS</code>: The format(s) of output figure(s) which can be one or multiple of PNG, JPG, TIF, PDF, EPS, SVG, and PS. Multiple formats are separated by comma, e.g., PNG,JPG,EPS.</li>
<li><code>LANG_CN</code>: Whether Chinese are included (True) or not (False) in labels and legend texts, etc.</li>
<li><code>FONT_TITLE</code>: Font title (font name) for the output figures. Below are tips to check the available fonts or use new ones.<ul>
<li>Get the currently available font titles by the following Python code. <div class="fragment"><div class="line">```py</div>
<div class="line">from matplotlib import font_manager</div>
<div class="line">flist = font_manager.get_fontconfig_fonts()</div>
<div class="line">font_names = list()</div>
<div class="line">for fname in flist:</div>
<div class="line">    try:</div>
<div class="line">        font_names.append(font_manager.FontProperties(fname=fname).get_name())</div>
<div class="line">    except IOError or Exception:</div>
<div class="line">        continue</div>
<div class="line">print(font_names)</div>
<div class="line">```</div>
</div><!-- fragment --></li>
<li>To add and use a new font:<ul>
<li>Download a font with <code>.ttf</code> format such as YaHei Mono which supports a hybrid of Chinese and English. If you have only .ttc formatted font file, you may want to convert it to .ttf file using transfonter.</li>
<li>Copy the font file to the font directory of matplotlib, e.g., <code>D:\demo\python27\Lib\site-packages\matplotlib\mpl-data\fonts\ttf</code></li>
<li>Delete the cache files of matplotlib font located in the Windows userâ€™s directory, e.g., <code>C:\Users\ZhuLJ\.matplotlib</code>. The cache files may be fontList.cache and <code>fontList.json</code> for Python 2, and <code>fontList.py3k.cache</code> and <code>fontList-v300.json</code> for Python 3.</li>
<li>Now the new font should be available for plotting. If the new font is not rendered, it may be because matplotlib needs to refresh its font cache. Run the following Python code to rebuild it.</li>
</ul>
</li>
</ul>
</li>
<li>Font sizes of title (<code>TITLE_FONTSIZE</code>), legend (<code>LEGEND_FONTSIZE</code>), axis-tick label (<code>TICKLABEL_FONTSIZE</code>), axis label (<code>AXISLABEL_FONTSIZE</code>), and universal label (<code>LABEL_FONTSIZE</code>) in points.</li>
<li><code>DPI</code>: The resolution in dots (Integer) per inch, which is applied to non-vector formats.</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">[SEIMS_Model]</div>
<div class="line">HOSTNAME = 127.0.0.1</div>
<div class="line">PORT = 27017</div>
<div class="line">MODEL_DIR = D:\demo\SEIMS\data\youwuzhen\demo_youwuzhen30m_longterm_model</div>
<div class="line">BIN_DIR = D:\demo\SEIMS\bin</div>
<div class="line">scenarioID = 0</div>
<div class="line">calibrationID = -1</div>
<div class="line"> </div>
<div class="line">[PARAMETERS]</div>
<div class="line">PLOT_SUBBASINID = 4</div>
<div class="line">PLOT_VARIABLES = Q SED</div>
<div class="line"> </div>
<div class="line">[OPTIONAL_PARAMETERS]</div>
<div class="line"># Calibration period (UTCTIME)</div>
<div class="line">Cali_Time_start = 2013-01-01 00:00:00</div>
<div class="line">Cali_Time_end = 2015-12-31 23:59:59</div>
<div class="line"># Validation period (UTCTIME)</div>
<div class="line">#Vali_Time_start = 2013-01-01 00:00:00</div>
<div class="line">#Vali_Time_end = 2013-12-31 23:59:59</div>
<div class="line"> </div>
<div class="line">[OPTIONAL_MATPLOT_SETTINGS]</div>
<div class="line">FIGURE_FORMATS = PDF,PNG</div>
<div class="line">LANG_CN = False</div>
<div class="line">FONT_TITLE = Times New Roman</div>
<div class="line">TITLE_FONTSIZE = 14</div>
<div class="line">LEGEND_FONTSIZE = 12</div>
<div class="line">TICKLABEL_FONTSIZE = 12</div>
<div class="line">AXISLABEL_FONTSIZE = 12</div>
<div class="line">LABEL_FONTSIZE = 14</div>
<div class="line">DPI = 300</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md65"></a>
Advanced usage</h1>
<p >The Python scripts of postprocessing are in <code>SEIMS/seims/postprocess</code>. The <code>main.py</code> is the entrance of postprocessing which can be executed though the unified format of running SEIMS Python scripts, e.g.,</p>
<div class="fragment"><div class="line">cd D:\demo\SEIMS\seims\postprocess</div>
<div class="line">python main.py -ini D:\demo\SEIMS\data\youwuzhen\workspace\postprocess.ini</div>
</div><!-- fragment --><p >To illustrate the functionality of postprocessing, Figure 4 showed the calibration and validation of the simulated streamflow (Q, m<sup>3</sup>/s) at the watershed outlet derived from the demo Youwuzhen watershed model with default model parameters with Chinese labels and legend texts based on <code>YaHei Mono font</code> (see below for changes of the configuration).</p>
<div class="fragment"><div class="line">[OPTIONAL_PARAMETERS]</div>
<div class="line"># Calibration period (UTCTIME)</div>
<div class="line">Cali_Time_start = 2014-01-01 00:00:00</div>
<div class="line">Cali_Time_end = 2015-12-31 23:59:59</div>
<div class="line"># Validation period (UTCTIME)</div>
<div class="line">Vali_Time_start = 2013-01-01 00:00:00</div>
<div class="line">Vali_Time_end = 2013-12-31 23:59:59</div>
<div class="line"> </div>
<div class="line">[OPTIONAL_MATPLOT_SETTINGS]</div>
<div class="line">FIGURE_FORMATS = PDF,PNG</div>
<div class="line">LANG_CN = True</div>
<div class="line">FONT_TITLE = YaHei Mono</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md66"></a>
See more...</h1>
<p >Also see introduction of the Python package <a class="el" href="intro_postprocess_pkg.html">seims.postprocess package</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
